const commonChartOptions={tooltip:{trigger:'item',formatter:'{b}'},series:[{type:'map',roam:false,selectedMode:false,label:{show:false,},itemStyle:{normal:{areaColor:'#ccc',borderColor:'#fff',borderWidth:1},emphasis:{areaColor:'#999',label:{show:false}}}}]};let currentMap='china';let chartInstance=null;const provinceMapConfig={'辽宁':{mapName:'liaoning',jsonPath:'/_javascripts/21.json',seriesName:'辽宁地图'},'四川':{mapName:'sichuan',jsonPath:'/_javascripts/51.json',seriesName:'四川地图'},'广东':{mapName:'guangdong',jsonPath:'/_javascripts/44.json',seriesName:'广东地图'}};function initMap({selector,mapName,jsonPath,seriesName,data,onClick}){if(chartInstance){chartInstance.dispose();chartInstance=null;}
const chartDom=document.querySelector(selector);if(!chartDom)return;const chart=echarts.init(chartDom);chartInstance=chart;fetch(jsonPath).then(res=>res.json()).then(geoJson=>{echarts.registerMap(mapName,geoJson);const option={...commonChartOptions,series:[{...commonChartOptions.series[0],name:seriesName,map:mapName,data:data||[]}]};chart.setOption(option);if(onClick){chart.on('click',params=>{if(params.componentType==='series'&&params.seriesType==='map'){onClick(params.name);}});}}).catch(err=>console.error(`${seriesName}地图加载失败:`,err));}
function handleMapToggle(provinceName){const mapContainer=document.getElementById('map-container');if(currentMap==='china'){const config=provinceMapConfig[provinceName];if(config){currentMap=provinceName;initMap({selector:'#map-container',...config,onClick:handleMapToggle});}else{alert(`暂未支持${provinceName}地图`);}}
else{currentMap='china';initMap({selector:'#map-container',mapName:'china',jsonPath:'/_javascripts/china.json',seriesName:'中国地图',data:[{name:'辽宁',itemStyle:{normal:{areaColor:'#1890ff'},emphasis:{areaColor:'#40a9ff'}}},{name:'四川',itemStyle:{normal:{areaColor:'#1890ff'},emphasis:{areaColor:'#40a9ff'}}},{name:'广东',itemStyle:{normal:{areaColor:'#1890ff'},emphasis:{areaColor:'#40a9ff'}}}],onClick:handleMapToggle});}}
initMap({selector:'#map-container',mapName:'china',jsonPath:'/_javascripts/china.json',seriesName:'中国地图',data:[{name:'辽宁',itemStyle:{normal:{areaColor:'#1890ff'},emphasis:{areaColor:'#40a9ff'}}},{name:'四川',itemStyle:{normal:{areaColor:'#1890ff'},emphasis:{areaColor:'#40a9ff'}}},{name:'广东',itemStyle:{normal:{areaColor:'#1890ff'},emphasis:{areaColor:'#40a9ff'}}}],onClick:handleMapToggle});