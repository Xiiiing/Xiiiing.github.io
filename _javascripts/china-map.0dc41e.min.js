const baseOptions={tooltip:{trigger:'item',formatter:'{b}'},series:[{type:'map',roam:false,selectedMode:false,label:{show:false},itemStyle:{normal:{areaColor:'#ececec',borderColor:'#ffffff',borderWidth:1},emphasis:{areaColor:'#b3b3b3',label:{show:true}}}}]};const MAP_FILES={china:{mapName:'china',jsonPath:'/_javascripts/china.json',seriesName:'中国地图'},liaoning:{mapName:'liaoning',jsonPath:'/_javascripts/21.json',seriesName:'辽宁省'},sichuan:{mapName:'sichuan',jsonPath:'/_javascripts/51.json',seriesName:'四川省'},guangdong:{mapName:'guangdong',jsonPath:'/_javascripts/44.json',seriesName:'广东省'}};let currentKey='china';let chart=null;async function renderMap(key,data=[]){const container=document.getElementById('map-container');if(!container)return;showLoading(true);if(chart){chart.dispose();}
chart=echarts.init(container);const{jsonPath,mapName,seriesName}=MAP_FILES[key];try{const resp=await fetch(jsonPath);const geo=await resp.json();echarts.registerMap(mapName,geo);const option={...baseOptions,series:[{...baseOptions.series[0],name:seriesName,map:mapName,data}]};chart.setOption(option);chart.off('click');chart.on('click',params=>{if(params.componentType==='series'){toggleMap(params.name.toLowerCase());}});}catch(e){console.error(`${seriesName} 加载失败`,e);}finally{showLoading(false);}}
function toggleMap(nameKey){if(currentKey==='china'&&MAP_FILES[nameKey]){currentKey=nameKey;renderMap(currentKey);}else{currentKey='china';const highlightData=Object.keys(MAP_FILES).filter(k=>k!=='china').map(k=>({name:MAP_FILES[k].seriesName,itemStyle:{normal:{areaColor:'#1890ff'},emphasis:{areaColor:'#40a9ff'}}}));renderMap('china',highlightData);}}
function showLoading(flag){let loader=document.querySelector('.map-loading');if(flag){if(!loader){loader=document.createElement('div');loader.className='map-loading';loader.textContent='加载中...';document.getElementById('map-container').append(loader);}}else if(loader){loader.remove();}}
window.addEventListener('resize',()=>{if(chart)chart.resize();});document.addEventListener('DOMContentLoaded',()=>{renderMap('china',[{name:'辽宁省',itemStyle:{normal:{areaColor:'#1890ff'},emphasis:{areaColor:'#40a9ff'}}},{name:'四川省',itemStyle:{normal:{areaColor:'#1890ff'},emphasis:{areaColor:'#40a9ff'}}},{name:'广东省',itemStyle:{normal:{areaColor:'#1890ff'},emphasis:{areaColor:'#40a9ff'}}}]);});