const commonChartOptions={title:{text:'求学 驻足',left:'center',top:10,textStyle:{fontSize:18}},tooltip:{trigger:'item',formatter:'{b}'},series:[{type:'map',roam:false,selectedMode:false,layoutCenter:['50%','50%'],layoutSize:'100%',label:{show:false},itemStyle:{normal:{areaColor:'#ccc',borderColor:'#fff',borderWidth:1},emphasis:{areaColor:'#999',label:{show:false}}}}]};const provinceMapConfig={'辽宁省':{mapName:'liaoning',jsonPath:'/_javascripts/21.json',seriesName:'辽宁地图'},'四川省':{mapName:'sichuan',jsonPath:'/_javascripts/51.json',seriesName:'四川地图'},'广东省':{mapName:'guangdong',jsonPath:'/_javascripts/44.json',seriesName:'广东地图'}};const highlightData={'china':[{name:'辽宁省'},{name:'四川省'},{name:'广东省'}],'辽宁省':[{name:'沈阳市'}],'四川省':[{name:'绵阳市'},{name:'宜宾市'}],'广东省':[{name:'深圳市'}]};let currentMap='china';let chartInstance=null;const initMap=async({mapName,jsonPath,seriesName,data})=>{if(chartInstance){chartInstance.dispose();chartInstance=null;}
const container=document.querySelector('#map-container');if(!container)return;const chart=echarts.init(container);chartInstance=chart;try{const res=await fetch(jsonPath);const geoJson=await res.json();echarts.registerMap(mapName,geoJson);const option={...commonChartOptions,series:[{...commonChartOptions.series[0],name:seriesName,map:mapName,data:data.map(item=>({...item,itemStyle:{normal:{areaColor:'#1890ff'},emphasis:{areaColor:'#40a9ff'}}}))}]};chart.setOption(option);chart.off('click');chart.on('click',(params)=>{if(params.componentType==='series'){handleMapToggle(params.name);}});}catch(err){console.error(`${seriesName} 地图加载失败:`,err);}};function handleMapToggle(name){if(currentMap==='china'&&provinceMapConfig[name]){const{mapName,jsonPath,seriesName}=provinceMapConfig[name];currentMap=name;initMap({mapName,jsonPath,seriesName,data:highlightData[name]});}else if(currentMap==='china'){alert(`笔者未曾求学于${provinceMapConfig[name]}`);}else{currentMap='china';initMap({mapName:'china',jsonPath:'/_javascripts/china.json',seriesName:'中国地图',data:highlightData.china});}}
initMap({mapName:'china',jsonPath:'/_javascripts/china.json',seriesName:'中国地图',data:highlightData.china});