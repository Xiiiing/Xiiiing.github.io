const commonChartOptions={tooltip:{trigger:'item',formatter:'{b}'},series:[{type:'map',roam:false,selectedMode:false,label:{show:false},itemStyle:{normal:{areaColor:'#ccc',borderColor:'#fff',borderWidth:1},emphasis:{areaColor:'#999',label:{show:false}}}}]};const provinceCodeMap={'四川':'51','广东':'44','辽宁':'21',};function initEchartsMap({selector,mapName,jsonPath,seriesName,data=[],onClick}){document.addEventListener('DOMContentLoaded',()=>{const container=document.querySelector(selector);if(!container)return;if(container._echartsInstance){echarts.dispose(container._echartsInstance);}
const chart=echarts.init(container);container._echartsInstance=chart;fetch(jsonPath).then(res=>res.json()).then(geoJson=>{echarts.registerMap(mapName,geoJson);chart.setOption({...commonChartOptions,series:[{...commonChartOptions.series[0],name:seriesName,map:mapName,data:data}]});if(typeof onClick==='function'){chart.off('click');chart.on('click',params=>onClick(params,container));}}).catch(err=>{console.error(`${seriesName} 地图加载失败:`,err);});});}
function bindChinaDrill(){initEchartsMap({selector:'[data-echarts-map="china"]',mapName:'china',jsonPath:'/_javascripts/china.json',seriesName:'中国地图',onClick:(params,container)=>{const provinceName=params.name;const code=provinceCodeMap[provinceName];if(!code){console.warn(`未配置 ${provinceName} 的编码，无法钻取。`);return;}
initEchartsMap({selector:'[data-echarts-map="china"]',mapName:provinceName,jsonPath:`/_javascripts/${code}.json`,seriesName:`${provinceName} 地图`,onClick:()=>{bindChinaDrill();}});}});}
bindChinaDrill();