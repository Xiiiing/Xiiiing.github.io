const commonChartOptions={tooltip:{trigger:'item',formatter:'{b}'},series:[{type:'map',roam:false,selectedMode:false,label:{show:false},itemStyle:{normal:{areaColor:'#e0e0e0',borderColor:'#ffffff',borderWidth:0.8},emphasis:{areaColor:'#40a9ff',label:{show:false}}},aspectScale:0.9,mapLocation:{x:'center',y:'center'},boundingCoords:[[0,0],[1,1]]}]};let currentMap='china';let chartInstance=null;const provinceMapConfig={'辽宁':{mapName:'liaoning',jsonPath:'/_javascripts/21.json',seriesName:'辽宁地图'},'四川':{mapName:'sichuan',jsonPath:'/_javascripts/51.json',seriesName:'四川地图'},'广东':{mapName:'guangdong',jsonPath:'/_javascripts/44.json',seriesName:'广东地图'}};function initMap(options){if(chartInstance){chartInstance.dispose();chartInstance=null;}
const chartDom=document.getElementById('map-container');if(!chartDom)return;const chart=echarts.init(chartDom);chartInstance=chart;fetch(options.jsonPath).then(res=>res.json()).then(geoJson=>{echarts.registerMap(options.mapName,geoJson);const option={...commonChartOptions,series:[{...commonChartOptions.series[0],name:options.seriesName,map:options.mapName,data:options.data||[]}]};chart.setOption(option);chart.resize();if(options.onClick){chart.on('click',params=>{if(params.componentType==='series'&&params.seriesType==='map'){options.onClick(params.name);chart.resize();}});}}).catch(err=>{console.error(`${options.seriesName}地图加载失败:`,err);chartDom.innerHTML=`<div style="color: #ff4d4f; padding: 20px;">${options.seriesName}地图加载失败，请检查JSON路径</div>`;});}
function handleMapToggle(provinceName){if(currentMap==='china'){const config=provinceMapConfig[provinceName];if(config){currentMap=provinceName;initMap({selector:'#map-container',...config,onClick:handleMapToggle});}else{alert(`暂未支持${provinceName}地图`);}}
else{currentMap='china';initMap({selector:'#map-container',mapName:'china',jsonPath:'/_javascripts/china.json',seriesName:'中国地图',data:[{name:'辽宁',itemStyle:{normal:{areaColor:'#1890ff'}}},{name:'四川',itemStyle:{normal:{areaColor:'#1890ff'}}},{name:'广东',itemStyle:{normal:{areaColor:'#1890ff'}}}],onClick:handleMapToggle});}}
initMap({selector:'#map-container',mapName:'china',jsonPath:'/_javascripts/china.json',seriesName:'中国地图',data:[{name:'辽宁',itemStyle:{normal:{areaColor:'#1890ff'}}},{name:'四川',itemStyle:{normal:{areaColor:'#1890ff'}}},{name:'广东',itemStyle:{normal:{areaColor:'#1890ff'}}}],onClick:handleMapToggle});