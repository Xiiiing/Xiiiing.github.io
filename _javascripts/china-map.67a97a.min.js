(async function(){const chart=echarts.init(document.getElementById('map-container'));const rawGeo=await fetch('/_javascripts/china2.json').then(res=>res.json());echarts.registerMap('china-all',rawGeo);const byParent={};const name2code={};rawGeo.features.forEach(f=>{const code=String(f.properties.adcode);const parent=String(f.properties.parentCode||'');name2code[f.properties.name]=code;if(!byParent[parent])byParent[parent]=[];byParent[parent].push(f);});const stack=[];function render(code,title){if(code==='100000'){chart.setOption({title:{text:title,left:'center'},tooltip:{trigger:'item'},series:[{type:'map',map:'china-all',roam:true,emphasis:{label:{show:true}},data:[]}]});}else{const fc={type:'FeatureCollection',features:byParent[code]||[]};const mapKey='drill_'+code;echarts.registerMap(mapKey,fc);chart.setOption({title:{text:title,left:'center'},tooltip:{trigger:'item'},series:[{type:'map',map:mapKey,roam:true,emphasis:{label:{show:true}},data:[]}]});}}
stack.push({code:'100000',name:'中国'});render('100000','中国');chart.on('click',params=>{const name=params.name;const code=name2code[name];if(!code||!byParent[code]||byParent[code].length===0){alert(name+' 已经到底层或未找到子集');return;}
stack.push({code,name});render(code,name);});document.getElementById('btn-back').onclick=()=>{if(stack.length<=1)return;stack.pop();const prev=stack[stack.length-1];render(prev.code,prev.name);};})();